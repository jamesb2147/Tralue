<p id="notice"><%= notice %></p>
<h1>Credit card recommendations for <%= @result.name %></h1>

<table class="tablesaw table table-hover" data-tablesaw-mode="columntoggle" data-tablesaw-sortable data-tablesaw-sortable-switch data-tablesaw-minimap>
    <thead>
        <tr>
            <th scope="col" data-tablesaw-priority="persist">Name</th>
            <th scope="col" data-tablesaw-priority="6">By</th>
            <th scope="col" data-tablesaw-priority="1" data-tablesaw-sortable-col data-sortable-numeric>Percent of points required</th>
            <th scope="col" data-tablesaw-priority="2">Airline issuing ticket</th>
            <th scope="col" data-tablesaw-priority="3">Points to be earned</th>
            <th scope="col" data-tablesaw-priority="3">Points in program after transfer</th>
            <th scope="col" data-tablesaw-priority="3" data-tablesaw-sortable-col data-sortable-numeric>Points cost</th>
            <th scope="col" data-tablesaw-priority="2" data-tablesaw-sortable-col data-sortable-numeric>Cash copay</th>
            <th scope="col" data-tablesaw-priority="6">Includes transfer bonus?</th>
            <th scope="col" data-tablesaw-priority="5">Transfer notes</th>
            <th scope="col" data-tablesaw-priority="4">Credit card notes</th>
            <th scope="col" data-tablesaw-priority="2" data-tablesaw-sortable-col data-sortable-numeric>Annual fee</th>
            <th scope="col" data-tablesaw-priority="3">Waived first year?</th>
            <th scope="col" data-tablesaw-priority="1">Application</th>
            <th scope="col" data-tablesaw-priority="2" data-tablesaw-sortable-col data-sortable-numeric>Value of points</th>
            <th scope="col" data-tablesaw-priority="2" data-tablesaw-sortable-col data-sortable-numeric>CPM value</th>
            <!-- Total value of points for this redemption (cost of airfare - annual fee - copay) * percentage-->
            <!-- CPM value -->
        </tr>
    </thead>
    
    <tbody>
    <% @result.arrayofcards.each do |a| %>
        <tr>
            <td><%= link_to a["card"].name, creditcard_path(a["card"]), class: 'btn btn-info' %></td>
            <td><%= a["card"].issuer %></td>
            <td><%= sprintf("%.0f", a["percentage"]) + "%" %></td>
            <td><%= a["points_program"] %></td>
            <td><%= sprintf("%.0f", if a["total_bonus"].nil? then 0 else a["total_bonus"] end) %></td>
            <td><%= sprintf("%.0f", a["additional_points_in_program"]) %></td>
            <td><%= a["miles_required"] %></td>
            <td><%= "$" + sprintf("%.0f",a["copay"]) %></td>
            <td><%= if a["includes_transfer_bonus"] then "Yes" else "No" end %></td>
            <td><%= a["rate"].transfernotes %></td>
            <td><%= a["card"].notes %></td>
            <td><%= a["card"].annual_fee %></td>
            <td><%= if a["card"].fee_waived_first_year then "Yes" else "No" end %></td>
            <td><%= link_to a["card"].url, class: 'btn btn-success' do %>
                Application
            <% end %></td>
            <td><%= sprintf("%.0f", (@costs.costinusd * a["percentage"] / 100 - ( if a["card"].fee_waived_first_year then 0 else a["card"].annual_fee end ) - a["copay"])) %></td>
            <td><%= sprintf("%.1f", (@costs.costinusd * a["percentage"] / 100 - ( if a["card"].fee_waived_first_year then 0 else a["card"].annual_fee end ) - a["copay"]) / (a["card"].first_purchase_bonus + a["card"].spend_bonus + a["card"].spend_requirement) * a["rate"].transferratio * 100) %></td>
        </tr>
    <% end %>
    </tbody>
    
</table>

<%= link_to 'Back', trips_path, class: 'btn btn-primary' %>
